<div id="pokemonCreationModal"
     class="modal"
     aria-hidden="true"
     data-trainer-id="<%= trainer?.id || '' %>"
     data-mode=""
     data-slot="">

  <div class="modal-content">

    <!-- Modal Header with Step Indicator -->
    <div class="modal-header">
      <span class="step-indicator" id="modalStepIndicator">Step 1 of 2</span>
      <span class="close-btn" id="closeModalBtn" aria-label="Close">&times;</span>
    </div>

    <!-- STEP 1: Species Selection -->
    <div class="modal-step" data-step="species">
      <form id="speciesFilterForm" method="GET" action="javascript:void(0)">
        <input type="hidden" name="trainerId" value="<%= trainer.id %>" />

        <label>Types:</label>
        <select multiple name="types">
          <% types.forEach(type => { %>
            <option value="<%= type.id %>"><%= capFirst(type.name) %></option>
          <% }) %>
        </select>

        <label>Generations:</label>
        <select multiple name="generations">
          <% for (let i = 1; i < 10; i++) { %>
            <option value="<%= i %>">Gen <%= i %></option>
          <% }; %>
        </select>

        <label>Name:</label>
        <input type="text" name="name" />

        <button type="submit">Apply Filters</button>
      </form>

      <div id="speciesResults">
        <% speciesResults.forEach(species => { %>
          <div class="species-card"
              data-species-id="<%= species.species_id %>"
              <%= species.form_id ? `data-form-id="${species.form_id}"` : '' %>
              data-species-name="<%= species.name %>"
              data-form-name="<%= species.form_name || '' %>"
              data-image-url="<%= species.image_url %>"
              data-type1-id="<%= species.type_1_id %>"
              data-type2-id="<%= species.type_2_id || '' %>"
              data-generation="<%= species.generation %>">
            <img loading="lazy"
                src="<%= species.image_url %>"
                alt="<%= species.name %>">
            <p><%= species.name.charAt(0).toUpperCase() + species.name.slice(1) %></p>
          </div>
        <% }) %>
      </div>
    </div>

    <!-- STEP 2: Pokémon Details -->
    <div class="modal-step" data-step="details" hidden>
      <div class="details-header">
        <img id="details-sprite" src="" alt="" class="details-sprite">
        <h2 id="details-name"></h2>
      </div>

      <form id="pokemonDetailsForm" method="POST" action="javascript:void(0)">
        <label>Nickname:</label>
        <input type="text" name="nickname" maxlength="12" />

        <label>Level:</label>
        <input type="number" name="level" min="1" max="100" />

        <label>Gender:</label>
        <select name="gender">
          <option value="none">—</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>

        <label>Nature:</label>
        <select name="nature">
          <% natures.forEach(nature => { %>
            <option value="<%= nature.id %>"><%= capFirst(nature.name) %></option>
          <% }) %>
        </select>

        <div class="modal-actions">
          <button type="button" id="detailsBackBtn">← Back</button>
          <button type="submit">Save Pokémon</button>
        </div>
      </form>
    </div>

  </div>
</div>