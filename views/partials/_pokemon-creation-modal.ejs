<div id="pokemonCreationModal"
     class="modal"
     aria-hidden="true"
     data-trainer-id="<%= trainer?.id || '' %>"
     data-mode=""
     data-slot="">

  <div class="modal-content">

    <!-- Modal Header with Step Indicator -->
    <div class="modal-header">
      <span class="modal-title">Add Pokémon to <%= trainer.name %>'s Team</span>
      <span class="step-indicator" id="modalStepIndicator">Step 1 of 2</span>
      <span class="close-btn" id="closeModalBtn" aria-label="Close">&times;</span>
    </div>

    <!-- STEP 1: Species Selection -->
    <div class="modal-step" data-step="species">
      <form id="speciesFilterForm" method="GET" action="javascript:void(0)">
        <input type="hidden" name="trainerId" value="<%= trainer.id %>" />

        <div>
          <p class="filter-label">Types:</p>
          <fieldset id="type-filter">
            <div class="scroll-wrapper">
              <% types.forEach(type => { %>
                <input type="checkbox" name="types" class="type-box" value="<%= type.id %>"><%= capFirst(type.name) %></input><br>
              <% }) %>
            </div>
          </fieldset>
        </div>

        <div>
          <p class="filter-label">Generations:</p>
          <fieldset id="generation-filter">
            <div class="scroll-wrapper">
              <% for (let i = 1; i < 10; i++) { %>
                <input type="checkbox" name="generations" value="<%= i %>">Gen <%= i %></input><br>
              <% }; %>
            </div>
          </fieldset>
        </div>

        <div>
          <p class="filter-label">Name:</p>
          <input type="text" id="name" name="name" />
        </div>
          <button class="filter-btn" type="submit">Apply Filters</button>
      </form>

      <div id="speciesResults">
        <% speciesResults.forEach(species => { %>
          <div class="species-card"
              data-species-id="<%= species.species_id %>"
              <%= species.form_id ? `data-form-id="${species.form_id}"` : '' %>
              data-species-name="<%= species.name %>"
              data-form-name="<%= species.form_name || '' %>"
              data-image-url="<%= species.image_url %>"
              data-type1-id="<%= species.type_1_id %>"
              data-type2-id="<%= species.type_2_id || '' %>"
              data-generation="<%= species.generation %>">
            <img loading="lazy"
                src="<%= species.image_url %>"
                alt="<%= species.name %>">
            <p><%= species.name.charAt(0).toUpperCase() + species.name.slice(1) %></p>
          </div>
        <% }) %>
      </div>
    </div>

    <!-- STEP 2: Pokémon Details -->
    <div class="modal-step" data-step="details" hidden>
      <div class="details-header">
        <img id="details-sprite" src="" alt="" class="details-sprite">
        <div class="details-types">
          <div class="type-bubble">
            <img id="details-type1" class="type-icon" src="" alt="">
          </div>
          <div class="type-bubble">
            <img id="details-type2" class="type-icon" src="" alt="">
          </div>
        </div>        
        <h2 id="details-name"></h2>
      </div>

      <form id="pokemonDetailsForm" method="POST" action="javascript:void(0)">
        <div class="input-container">
          <label>Nickname:</label>
          <input type="text" name="nickname" maxlength="12" />
        </div>

        <div class="input-container">
          <label>Level:</label>
          <input type="number" name="level" min="1" max="100" required/>
        </div>

        <div class="input-container">
          <label>Gender:</label>
          <select name="gender">
            <option value="none">—</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>

        <div class="input-container">
          <label>Nature:</label>
          <select name="nature" required>
            <% natures.forEach(nature => { %>
              <option value="<%= nature.id %>"><%= capFirst(nature.name) %></option>
            <% }) %>
          </select>
        </div>

        <div class="modal-actions">
          <button class="back-btn" type="button" id="detailsBackBtn">< Back</button>
          <button class="submit-btn" type="submit">Save Pokémon</button>
        </div>
      </form>
    </div>

  </div>
</div>